# Linux Cron定时配置示例:
3,33 * * * *
 /root/anaconda3/bin/python /usr/local/electricity-monitoring/electricity-monitoring.py >> /usr/local/electricity-monitoring/electricity-monitoring.log 2>&1

# 智能电力监控系统-异常用电监测

## 项目概述

智能电力监控系统是一个用于酒店房间用电监控的自动化解决方案，能够实时检测房间用电异常情况，并将异常数据推送到飞书进行通知。系统通过分析历史用电数据建立基线模型，采用统计学方法检测异常用电模式，帮助酒店节约能源成本并提前预警潜在问题。

## 核心功能

1. **智能电表数据采集**
   - 从数据库采集多个酒店的智能电表数据
   - 支持按产品密钥和房间号分类数据

2. **用电异常检测**
   - 基于统计模型的瞬时用电异常检测
   - 连续高用电量监测（持续2小时以上）
   - 使用滑动窗口技术分析24小时历史数据

3. **房间信息关联**
   - 自动关联异常用电与酒店房间信息
   - 获取房间状态（住净、住脏、空净、空脏等）
   - 获取入住和退房信息

4. **异常数据处理**
   - 将异常数据保存到数据库
   - 通过飞书机器人推送异常警报

## 技术特点

- **自适应基线**: 系统通过24小时历史数据建立动态基线，适应不同类型房间的用电模式
- **多级异常检测**: 支持瞬时异常和持续异常两种检测模式，减少误报
- **安全边际机制**: 应用相对和绝对安全边际，提高检测精度
- **灵活的配置参数**: 可调整检测窗口大小、阈值倍数等参数
- **雪花ID生成**: 使用雪花算法生成唯一记录ID

## 数据流程

1. 系统定期从数据库获取智能电表数据
2. 对每个房间的用电数据进行分析和异常检测
3. 查询异常房间的附加信息（房间状态、入住情况等）
4. 将异常记录保存到异常用电表(abnormal_electricity_usage)
5. 通过飞书机器人发送异常通知

## 系统依赖

- Python 3.6+
- PyMySQL
- Requests
- python-dateutil
- 雪花ID生成器

## 部署说明

1. 确保数据库配置正确（修改DatabaseConfig类中的连接参数）
2. 确保已安装所有依赖库: `pip install pymysql requests python-dateutil`
3. 使用cron或其他调度工具定期执行脚本
4. 监控日志输出确认系统正常运行

## 扩展和优化方向

- 添加更多机器学习模型提高异常检测准确率
- 集成能耗预测功能帮助酒店进行能源管理
- 扩展支持更多IoT设备的监控
- 开发Web界面进行可视化监控